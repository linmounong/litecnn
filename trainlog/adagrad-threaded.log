c++ -std=c++11 -march=native -O3 -pthread  -I third_party/mnist/include -o bin/mnist_main src/mnist_main.cc layers.o ndarray.o loss.o cnn.o
bin/mnist_main
training using 4 threads
loaded 60000 from dataset.training_images
loaded 10000 from dataset.test_images
warming up...
0x7fff954b2380 iter:1 epoch:1 loss:4.77707
0x7fff954b2380 iter:2 epoch:1 loss:4.00265
0x7fff954b2380 iter:3 epoch:1 loss:3.16431
0x7fff954b2380 iter:4 epoch:1 loss:2.76238
0x7fff954b2380 iter:5 epoch:1 loss:2.28465
0x7fff954b2380 iter:6 epoch:1 loss:2.05026
0x7fff954b2380 iter:7 epoch:1 loss:3.2034
0x7fff954b2380 iter:8 epoch:1 loss:2.38663
thread thread thread 13thread 2((0(0x700009bde0000x700009ce4000(0x700009c61000) starting... from ) starting... from 0x700009b5b000) starting... from 1500045000) starting... from 30000 count  count 0 count 1500015000 count 15000

15000

0x700009ce4000 iter:10 epoch:1 loss:1.97473
0x700009bde000 iter:20 epoch:1 loss:3.04675
0x700009b5b000 iter:30 epoch:1 loss:1.51105
0x700009bde000 iter:40 epoch:1 loss:1.09555
0x700009b5b000 iter:50 epoch:1 loss:1.57355
0x700009bde000 iter:60 epoch:1 loss:1.04491
0x700009b5b000 iter:70 epoch:1 loss:0.888201
0x700009bde000 iter:80 epoch:1 loss:1.03001
0x700009b5b000 iter:90 epoch:1 loss:0.941651
0x700009bde000 iter:100 epoch:1 loss:0.795738
0x700009ce4000 iter:110 epoch:1 loss:0.604477
0x700009bde000 val_accuracy:0.918
0x700009ce4000 iter:120 epoch:1 loss:0.605361
0x700009bde000 iter:130 epoch:1 loss:0.95483
0x700009ce4000 iter:140 epoch:1 loss:0.577907
0x700009bde000 iter:150 epoch:1 loss:0.620238
0x700009ce4000 iter:160 epoch:1 loss:0.498713
0x700009bde000 iter:170 epoch:1 loss:0.509362
0x700009ce4000 iter:180 epoch:1 loss:0.544261
0x700009bde000 iter:190 epoch:1 loss:0.485702
0x700009ce4000 iter:200 epoch:1 loss:0.597481
0x700009b5b000 iter:210 epoch:1 loss:0.688165
0x700009ce4000 val_accuracy:0.927
0x700009b5b000 iter:220 epoch:1 loss:0.494514
0x700009c61000 iter:230 epoch:1 loss:0.578546
0x700009ce4000 iter:240 epoch:1 loss:0.592079
0x700009c61000 iter:250 epoch:1 loss:0.462397
0x700009b5b000 iter:260 epoch:1 loss:0.52325
0x700009c61000 iter:270 epoch:1 loss:0.736907
0x700009b5b000 iter:280 epoch:1 loss:0.56043
0x700009bde000 iter:290 epoch:1 loss:0.410081
0x700009b5b000 iter:300 epoch:1 loss:0.437773
0x700009bde000 iter:310 epoch:1 loss:0.397354
0x700009b5b000 val_accuracy:0.945
0x700009b5b000 iter:320 epoch:1 loss:0.470241
0x700009ce4000 iter:330 epoch:1 loss:0.495033
0x700009bde000 iter:340 epoch:1 loss:0.493774
0x700009ce4000 iter:350 epoch:1 loss:0.410221
0x700009bde000 iter:360 epoch:1 loss:0.52068
0x700009b5b000 iter:370 epoch:1 loss:0.529198
0x700009bde000 iter:380 epoch:1 loss:0.406913
0x700009c61000 iter:390 epoch:1 loss:0.690622
0x700009bde000 iter:400 epoch:1 loss:0.408913
0x700009ce4000 iter:410 epoch:1 loss:0.487719
0x700009bde000 val_accuracy:0.95
0x700009b5b000 iter:420 epoch:1 loss:0.492267
0x700009c61000 iter:430 epoch:1 loss:0.375569
0x700009b5b000 iter:440 epoch:1 loss:0.420265
0x700009c61000 iter:450 epoch:1 loss:0.3651
0x700009ce4000 iter:460 epoch:1 loss:0.435484
0x700009c61000 iter:470 epoch:1 loss:0.428411
0x700009ce4000 iter:480 epoch:1 loss:0.403527
0x700009c61000 iter:490 epoch:1 loss:0.351465
0x700009ce4000 iter:500 epoch:1 loss:0.401089
0x700009bde000 iter:510 epoch:1 loss:0.438358
0x700009ce4000 val_accuracy:0.947
0x700009bde000 iter:520 epoch:1 loss:0.335908
0x700009c61000 iter:530 epoch:1 loss:0.355599
0x700009bde000 iter:540 epoch:1 loss:0.434184
0x700009b5b000 iter:550 epoch:1 loss:0.418342
0x700009bde000 iter:560 epoch:1 loss:0.484371
0x700009b5b000 iter:570 epoch:1 loss:0.364073
0x700009bde000 iter:580 epoch:1 loss:0.357307
0x700009b5b000 iter:590 epoch:1 loss:0.430027
0x700009bde000 iter:600 epoch:1 loss:0.374916
0x700009ce4000 iter:610 epoch:1 loss:0.384348
0x700009bde000 val_accuracy:0.954
0x700009bde000 iter:620 epoch:1 loss:0.482601
0x700009c61000 iter:630 epoch:2 loss:0.38611
0x700009bde000 iter:640 epoch:1 loss:0.51733
0x700009c61000 iter:650 epoch:2 loss:0.486979
0x700009bde000 iter:660 epoch:2 loss:0.439158
0x700009c61000 iter:670 epoch:2 loss:0.367799
0x700009bde000 iter:680 epoch:2 loss:0.353309
0x700009c61000 iter:690 epoch:2 loss:0.371558
0x700009bde000 iter:700 epoch:2 loss:0.475813
0x700009b5b000 iter:710 epoch:2 loss:0.478163
0x700009bde000 val_accuracy:0.952
0x700009b5b000 iter:720 epoch:2 loss:0.359585
0x700009bde000 iter:730 epoch:2 loss:0.383938
0x700009b5b000 iter:740 epoch:2 loss:0.438971
0x700009bde000 iter:750 epoch:2 loss:0.40811
0x700009b5b000 iter:760 epoch:2 loss:0.303558
0x700009bde000 iter:770 epoch:2 loss:0.387497
0x700009b5b000 iter:780 epoch:2 loss:0.510816
0x700009bde000 iter:790 epoch:2 loss:0.417883
0x700009c61000 iter:800 epoch:2 loss:0.498153
0x700009ce4000 iter:810 epoch:2 loss:0.416514
0x700009c61000 val_accuracy:0.96
0x700009ce4000 iter:820 epoch:2 loss:0.389729
0x700009c61000 iter:830 epoch:2 loss:0.341065
0x700009ce4000 iter:840 epoch:2 loss:0.426247
0x700009c61000 iter:850 epoch:2 loss:0.309926
0x700009ce4000 iter:860 epoch:2 loss:0.381514
0x700009c61000 iter:870 epoch:2 loss:0.377505
0x700009ce4000 iter:880 epoch:2 loss:0.413416
0x700009b5b000 iter:890 epoch:2 loss:0.404448
0x700009ce4000 iter:900 epoch:2 loss:0.383755
0x700009bde000 iter:910 epoch:2 loss:0.351604
0x700009ce4000 val_accuracy:0.961
0x700009bde000 iter:920 epoch:2 loss:0.377429
0x700009c61000 iter:930 epoch:2 loss:0.326076
0x700009bde000 iter:940 epoch:2 loss:0.344098
0x700009c61000 iter:950 epoch:2 loss:0.350532
0x700009bde000 iter:960 epoch:2 loss:0.438184
0x700009ce4000 iter:970 epoch:2 loss:0.382497
0x700009bde000 iter:980 epoch:2 loss:0.338456
0x700009ce4000 iter:990 epoch:2 loss:0.357619
0x700009bde000 iter:1000 epoch:2 loss:0.399764
0x700009b5b000 iter:1010 epoch:2 loss:0.348847
0x700009bde000 val_accuracy:0.961
0x700009b5b000 iter:1020 epoch:2 loss:0.322436
0x700009ce4000 iter:1030 epoch:2 loss:0.485265
0x700009b5b000 iter:1040 epoch:2 loss:0.328989
0x700009bde000 iter:1050 epoch:2 loss:0.338833
0x700009b5b000 iter:1060 epoch:2 loss:0.419156
0x700009ce4000 iter:1070 epoch:2 loss:0.411476
0x700009b5b000 iter:1080 epoch:2 loss:0.34105
0x700009bde000 iter:1090 epoch:2 loss:0.463135
0x700009b5b000 iter:1100 epoch:2 loss:0.379828
0x700009ce4000 iter:1110 epoch:2 loss:0.302208
0x700009b5b000 val_accuracy:0.956
0x700009ce4000 iter:1120 epoch:2 loss:0.33969
0x700009b5b000 iter:1130 epoch:2 loss:0.444093
0x700009bde000 iter:1140 epoch:2 loss:0.429017
0x700009b5b000 iter:1150 epoch:2 loss:0.330533
0x700009bde000 iter:1160 epoch:2 loss:0.380911
0x700009b5b000 iter:1170 epoch:2 loss:0.337407
0x700009c61000 iter:1180 epoch:2 loss:0.34142
0x700009ce4000 iter:1190 epoch:2 loss:0.307891
final val accuracy:0.959 loss:0.337403
final val accuracy:0.959 loss:0.344535
0x700009bde000 iter:1200 epoch:2 loss:0.376903
final val accuracy:0.962 loss:0.324007
0x700009bde000 val_accuracy:0.963
final val accuracy:0.962 loss:0.430206
training took 826s
final test accuracy 0.9611
training using 1 threads
loaded 60000 from dataset.training_images
loaded 10000 from dataset.test_images
warming up...
0x7fff954b2380 iter:1 epoch:1 loss:4.77707
0x7fff954b2380 iter:2 epoch:1 loss:3.54002
thread 0(0x700009563000) starting... from 0 count 60000
0x700009563000 iter:10 epoch:1 loss:1.85683
0x700009563000 iter:20 epoch:1 loss:1.09428
0x700009563000 iter:30 epoch:1 loss:0.936262
0x700009563000 iter:40 epoch:1 loss:0.937132
0x700009563000 iter:50 epoch:1 loss:1.02636
0x700009563000 iter:60 epoch:1 loss:0.735234
0x700009563000 iter:70 epoch:1 loss:0.650154
0x700009563000 iter:80 epoch:1 loss:0.51795
0x700009563000 iter:90 epoch:1 loss:0.58644
0x700009563000 iter:100 epoch:1 loss:0.556393
0x700009563000 val_accuracy:0.93
0x700009563000 iter:110 epoch:1 loss:0.476798
0x700009563000 iter:120 epoch:1 loss:0.561584
0x700009563000 iter:130 epoch:1 loss:0.409924
0x700009563000 iter:140 epoch:1 loss:0.484844
0x700009563000 iter:150 epoch:1 loss:0.513076
0x700009563000 iter:160 epoch:1 loss:0.398432
0x700009563000 iter:170 epoch:1 loss:0.500598
0x700009563000 iter:180 epoch:1 loss:0.377629
0x700009563000 iter:190 epoch:1 loss:0.408044
0x700009563000 iter:200 epoch:1 loss:0.454469
0x700009563000 val_accuracy:0.941
0x700009563000 iter:210 epoch:1 loss:0.55887
0x700009563000 iter:220 epoch:1 loss:0.370189
0x700009563000 iter:230 epoch:1 loss:0.517446
0x700009563000 iter:240 epoch:1 loss:0.494675
0x700009563000 iter:250 epoch:1 loss:0.404057
0x700009563000 iter:260 epoch:1 loss:0.419848
0x700009563000 iter:270 epoch:1 loss:0.441321
0x700009563000 iter:280 epoch:1 loss:0.38358
0x700009563000 iter:290 epoch:1 loss:0.397825
0x700009563000 iter:300 epoch:1 loss:0.439204
0x700009563000 val_accuracy:0.934
0x700009563000 iter:310 epoch:1 loss:0.36688
0x700009563000 iter:320 epoch:1 loss:0.377679
0x700009563000 iter:330 epoch:1 loss:0.367079
0x700009563000 iter:340 epoch:1 loss:0.354304
0x700009563000 iter:350 epoch:1 loss:0.454598
0x700009563000 iter:360 epoch:1 loss:0.380342
0x700009563000 iter:370 epoch:1 loss:0.5589
0x700009563000 iter:380 epoch:1 loss:0.45633
0x700009563000 iter:390 epoch:1 loss:0.362482
0x700009563000 iter:400 epoch:1 loss:0.386882
0x700009563000 val_accuracy:0.956
0x700009563000 iter:410 epoch:1 loss:0.409129
0x700009563000 iter:420 epoch:1 loss:0.445675
0x700009563000 iter:430 epoch:1 loss:0.434567
0x700009563000 iter:440 epoch:1 loss:0.393999
0x700009563000 iter:450 epoch:1 loss:0.282661
0x700009563000 iter:460 epoch:1 loss:0.499159
0x700009563000 iter:470 epoch:1 loss:0.309364
0x700009563000 iter:480 epoch:1 loss:0.302682
0x700009563000 iter:490 epoch:1 loss:0.353795
0x700009563000 iter:500 epoch:1 loss:0.386278
0x700009563000 val_accuracy:0.955
0x700009563000 iter:510 epoch:1 loss:0.356633
0x700009563000 iter:520 epoch:1 loss:0.34399
0x700009563000 iter:530 epoch:1 loss:0.347926
0x700009563000 iter:540 epoch:1 loss:0.39766
0x700009563000 iter:550 epoch:1 loss:0.31774
0x700009563000 iter:560 epoch:1 loss:0.417164
0x700009563000 iter:570 epoch:1 loss:0.355048
0x700009563000 iter:580 epoch:1 loss:0.455534
0x700009563000 iter:590 epoch:1 loss:0.380669
0x700009563000 iter:600 epoch:1 loss:0.505452
0x700009563000 val_accuracy:0.952
0x700009563000 iter:610 epoch:2 loss:0.316775
0x700009563000 iter:620 epoch:2 loss:0.425147
0x700009563000 iter:630 epoch:2 loss:0.34729
0x700009563000 iter:640 epoch:2 loss:0.468668
0x700009563000 iter:650 epoch:2 loss:0.452069
0x700009563000 iter:660 epoch:2 loss:0.447017
0x700009563000 iter:670 epoch:2 loss:0.418093
0x700009563000 iter:680 epoch:2 loss:0.353344
0x700009563000 iter:690 epoch:2 loss:0.393939
0x700009563000 iter:700 epoch:2 loss:0.371786
0x700009563000 val_accuracy:0.961
0x700009563000 iter:710 epoch:2 loss:0.339914
0x700009563000 iter:720 epoch:2 loss:0.384637
0x700009563000 iter:730 epoch:2 loss:0.318441
0x700009563000 iter:740 epoch:2 loss:0.370315
0x700009563000 iter:750 epoch:2 loss:0.394034
0x700009563000 iter:760 epoch:2 loss:0.31135
0x700009563000 iter:770 epoch:2 loss:0.392375
0x700009563000 iter:780 epoch:2 loss:0.30353
0x700009563000 iter:790 epoch:2 loss:0.345395
0x700009563000 iter:800 epoch:2 loss:0.393313
0x700009563000 val_accuracy:0.964
0x700009563000 iter:810 epoch:2 loss:0.434264
0x700009563000 iter:820 epoch:2 loss:0.298625
0x700009563000 iter:830 epoch:2 loss:0.431996
0x700009563000 iter:840 epoch:2 loss:0.385379
0x700009563000 iter:850 epoch:2 loss:0.33193
0x700009563000 iter:860 epoch:2 loss:0.363416
0x700009563000 iter:870 epoch:2 loss:0.378842
0x700009563000 iter:880 epoch:2 loss:0.324959
0x700009563000 iter:890 epoch:2 loss:0.340417
0x700009563000 iter:900 epoch:2 loss:0.372323
0x700009563000 val_accuracy:0.95
0x700009563000 iter:910 epoch:2 loss:0.332718
0x700009563000 iter:920 epoch:2 loss:0.340313
0x700009563000 iter:930 epoch:2 loss:0.335342
0x700009563000 iter:940 epoch:2 loss:0.329741
0x700009563000 iter:950 epoch:2 loss:0.409294
0x700009563000 iter:960 epoch:2 loss:0.352188
0x700009563000 iter:970 epoch:2 loss:0.501736
0x700009563000 iter:980 epoch:2 loss:0.403331
0x700009563000 iter:990 epoch:2 loss:0.331009
0x700009563000 iter:1000 epoch:2 loss:0.343881
0x700009563000 val_accuracy:0.962
0x700009563000 iter:1010 epoch:2 loss:0.392129
0x700009563000 iter:1020 epoch:2 loss:0.409904
0x700009563000 iter:1030 epoch:2 loss:0.39108
0x700009563000 iter:1040 epoch:2 loss:0.359055
0x700009563000 iter:1050 epoch:2 loss:0.26028
0x700009563000 iter:1060 epoch:2 loss:0.452132
0x700009563000 iter:1070 epoch:2 loss:0.293461
0x700009563000 iter:1080 epoch:2 loss:0.282769
0x700009563000 iter:1090 epoch:2 loss:0.325293
0x700009563000 iter:1100 epoch:2 loss:0.363645
0x700009563000 val_accuracy:0.959
0x700009563000 iter:1110 epoch:2 loss:0.326356
0x700009563000 iter:1120 epoch:2 loss:0.322254
0x700009563000 iter:1130 epoch:2 loss:0.325969
0x700009563000 iter:1140 epoch:2 loss:0.374953
0x700009563000 iter:1150 epoch:2 loss:0.299239
0x700009563000 iter:1160 epoch:2 loss:0.397808
0x700009563000 iter:1170 epoch:2 loss:0.34083
0x700009563000 iter:1180 epoch:2 loss:0.432534
0x700009563000 iter:1190 epoch:2 loss:0.337471
0x700009563000 iter:1200 epoch:2 loss:0.464453
0x700009563000 val_accuracy:0.96
final val accuracy:0.953 loss:0.319341
training took 1582s
final test accuracy 0.9615
